#!/usr/bin/env ruby

require 'puppet_generator'
require 'thor'
require 'pry'

class Default < Thor
  class_option :source , type: :string, default: 'input.txt', desc: 'enter the source which should be used to generate the puppet output' 
  class_option :destination , type: :string, default: 'dir:out.d', desc: 'where should the information be stored. Valid input is "file|dir:<dest>" or "stdout"'
  class_option :module , type: :string, default: 'mymodule', desc: 'the module prefix in puppet class name'
  class_option :class , type: :string, default: 'myclass', desc: 'the class suffix in puppet class name'

  desc 'package', 'generate package definitions'
  def package
    task = PuppetGenerator::Task.new
    task.meta[:source] = options[:source] 
    task.meta[:destination] = options[:destination]
    task.meta[:module] = options[:module]
    task.meta[:class] = options[:class]

    task.is_package_task

    api = PuppetGenerator::Api.new  
    api.generate_package_definition(task)
  end

  #method_option :input_format , type: :string, default: 'plain', desc: 'format of the input data'
  desc 'file', 'generate file definitions'
  def file
    task = PuppetGenerator::Task.new
    task.meta[:source] = options[:source] 
    task.meta[:destination] = options[:destination]
    task.meta[:module] = options[:module]
    task.meta[:class] = options[:class]
    #task.meta[:input_format] = options[:input_format]

    task.is_file_task

    api = PuppetGenerator::Api.new  
    api.generate_file_definition(task)
  end
end

Default.start
